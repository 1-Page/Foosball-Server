{% extends "base.html" %}

{% block content %}
    {{super()}}



    <script type="text/javascript">
        var source = new EventSource("{{ url_for('get_game_score', timestamp=game.timestamp) }}");
        source.onmessage = function (event) {
                var data = JSON.parse(event.data);
                $('#score_left').text(data.score_left);
                $('#score_right').text(data.score_right);
                $('#timeleft').text(data.timeleft);
                $('#summary').text(data.summary);
                //document.getElementById("score_left").innerHTML = data.score_left;
                //document.getElementById("score_right").innerHTML = data.score_right;
                //document.getElementById("timeleft").innerHTML = data.timeleft;
                //document.getElementById("summary").innerHTML = data.summary;
                if (data.ended) {
                    location.reload(true);
                }
        };

    </script>

    <div class="container game">
        <div class="container h1">

            <div class="col-xs-2 text-left">
                {{ game.team_left.defense_player.name }}<br/>
                {{ game.team_left.attack_player.name }}
            </div>

            <div class="col-xs-8 text-center score">
                <span id="score_left">{{ game.score_left }}</span> x <span id="score_right">{{ game.score_right }}</span>
            </div>

            <div class="col-xs-2 text-right">
                {{ game.team_right.defense_player.name }}<br/>
                {{ game.team_right.attack_player.name }}
            </div>
        </div>

        {% if not game.ended %}
        <div class="container text-center h1">
            <div class="time">
                Time left: <span id="timeleft">{{ game.time_left_string() }}</span>
            </div>


            <div class="container btn btn-lg btn-success center-block end_game_btn">
                <a href="{{ url_for('end_game', timestamp=game.timestamp)  }}">End Game</a>
            </div>

        </div>
        {% else %}
          <div class="container text-center h3">
          <hr/>
            <span class="timestamp">
                <a href={{ url_for('games_get', timestamp=game.timestamp) }}>
                    {{ game.timestamp }}
                </a>
            </span>
            <span class="summary" id="summary">
                 {{  game.summary() }}
            </span>
          </div>
        {% endif %}

    </div>


    <hr/>

    <div class="container">

    <div class="h2 text-center">Start a new game</div>

    <form action="{{ url_for('games_get_post') }}" method=post class="container">
        <div class="col-xs-5 col-xs-offset-1">
            <label for="leftTeam" class="h2">Yellow Team</label>
            <div class="form-group" id="leftTeam">
                <label for="leftDefense">Defense</label>
                <select name="left_defense_player_name" id="leftDefense" class="form-control">
                        {% for player in players %}
                            {% if (game is defined) and (player.name == game.team_left.defense_player.name) %}
                                <option name="{{ player.name  }}" SELECTED>{{ player.name|safe  }}</option>
                            {% else %}
                                <option name="{{ player.name  }}">{{ player.name|safe  }}</option>
                            {% endif %}
                        {% endfor %}
                  </select>
                <label for="leftAttack">Attack</label>
                <select name="left_attack_player_name" id="leftAttack" class="form-control">
                        {% for player in players %}
                            {% if (game is defined) and (player.name == game.team_left.attack_player.name) %}
                                <option name="{{ player.name  }}" SELECTED>{{ player.name|safe  }}</option>
                            {% else %}
                                <option name="{{ player.name  }}">{{ player.name|safe  }}</option>
                            {% endif %}
                        {% endfor %}
                </select>
            </div>
        </div>
        <div class="col-xs-5">
            <label for="rightTeam" class="h2">White Team</label>
            <div class="form-group" id="rightTeam">
                <label for="rightAttack">Attack</label>
                <select name="right_attack_player_name" id="rightAttack" class="form-control">
                        {% for player in players %}
                            {% if (game is defined) and (player.name == game.team_right.attack_player.name) %}
                                <option name="{{ player.name  }}" SELECTED>{{ player.name|safe  }}</option>
                            {% else %}
                                <option name="{{ player.name  }}">{{ player.name|safe  }}</option>
                            {% endif %}

                        {% endfor %}
                </select>
                <label for="rightDefense">Defense</label>
                <select name="right_defense_player_name" id="rightDefense" class="form-control">
                        {% for player in players %}
                            {% if (game is defined) and (player.name == game.team_right.defense_player.name) %}
                                <option name="{{ player.name  }}" SELECTED>{{ player.name|safe  }}</option>
                            {% else %}
                                <option name="{{ player.name  }}">{{ player.name|safe  }}</option>
                            {% endif %}
                        {% endfor %}
                  </select>
            </div>
        </div>
        <input type=submit value="New game" class="btn btn-lg center-block btn-success">
    </form>

    </div>

    <div class="container">

    </div>


{% endblock %}










